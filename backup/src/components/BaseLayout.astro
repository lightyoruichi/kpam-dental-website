---
import '../styles/globals.css';
import Head from './Head.astro';
import Header from './Header.astro';
import Footer from './Footer.astro';
import Breadcrumb, { type BreadcrumbItem } from './Breadcrumb.astro';
import StructuredData from './StructuredData.astro';

export interface Props {
  title: string;
  description: string;
  keywords?: string;
  canonical?: string;
  ogTitle?: string;
  ogDescription?: string;
  ogImage?: string;
  ogType?: string;
  ogUrl?: string;
  structuredData?: object | object[];
  additionalMeta?: Array<{
    name?: string;
    property?: string;
    content: string;
  }>;
  currentPage?: string;
  breadcrumbItems?: BreadcrumbItem[];
  tallyScript?: boolean;
}

const {
  title,
  description,
  keywords,
  canonical,
  ogTitle,
  ogDescription,
  ogImage,
  ogType,
  ogUrl,
  structuredData,
  additionalMeta,
  currentPage,
  breadcrumbItems = [],
  tallyScript = false
} = Astro.props;

---

<html lang="en">
  <Head
    {title}
    {description}
    {keywords}
    {canonical}
    {ogTitle}
    {ogDescription}
    {ogImage}
    {ogType}
    {ogUrl}
    structuredData={Array.isArray(structuredData) ? undefined : structuredData}
    {additionalMeta}
  />
  
  <!-- Root-level Organization structured data -->
  <StructuredData type="organization" />
  
  <!-- Root-level WebSite structured data -->
  <StructuredData type="website" />
  
  {Array.isArray(structuredData) && structuredData.map((data) => (
    <script type="application/ld+json" set:html={JSON.stringify(data)}></script>
  ))}

  {tallyScript && (
    <script async src="https://tally.so/widgets/embed.js"></script>
  )}

  <body class="bg-black text-white" style="font-family: 'Noto Sans', sans-serif;">
    <!-- Google Tag Manager (noscript) -->
    <noscript>
      <iframe 
        src="https://www.googletagmanager.com/ns.html?id=GTM-TZVBZM6N"
        height="0" 
        width="0" 
        style="display:none;visibility:hidden">
      </iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="max-w-6xl mx-auto p-4 md:p-8 space-y-8">
      <Header {currentPage} />
      
      {breadcrumbItems.length > 0 && (
        <Breadcrumb items={breadcrumbItems} />
      )}
      
      <main class="space-y-8">
        <slot />
      </main>
      
      <Footer {currentPage} />
    </div>
  </body>
</html>
